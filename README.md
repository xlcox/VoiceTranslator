# Voice Translator with SoundPad Integration

## Проект: Голосовой переводчик с воспроизведением через SoundPad

### Описание проекта

Приложение для перевода голосовой речи в реальном времени с последующим воспроизведением переведенного текста через систему SoundPad. Программа записывает аудио с микрофона по горячей клавише, распознает речь с помощью Whisper, переводит текст через Argos Translate (офлайн), синтезирует речь через Edge TTS и воспроизводит результат одновременно через динамики и виртуальный микрофон SoundPad.

### Архитектура системы

#### Структура проекта

main.py                 # Точка входа приложения
requirements.txt        # Зависимости Python
config.json            # Файл конфигурации
constants.py           # Константы приложения
core/                  # Основные модули
    config.py          # Управление конфигурацией
    logger_config.py   # Настройка логирования
    soundpad_manager.py # Управление SoundPad
    voice_translator.py # Основная логика перевода
logs/                  # Директория для логов
models/                # Локальные модели перевода (опционально)

#### Основные компоненты

1. **Main (main.py)** - Инициализация и запуск приложения, обработка сигналов завершения, управление жизненным циклом асинхронного приложения.

2. **Конфигурация (core/config.py)** - Централизованное управление настройками через JSON-файл. Автоматически создает конфиг с настройками по умолчанию при первом запуске, поддерживает рекурсивное объединение пользовательских настроек со значениями по умолчанию.

3. **Константы (constants.py)** - Технические параметры приложения, которые не требуют изменения пользователем (частота дискретизации, таймауты, пути и т.д.).

4. **Логирование (core/logger_config.py)** - Единая система логирования с выводом в файл (logs/app.log) и консоль. Форматирование включает временные метки, уровни, имена модулей. Поддерживает UTF-8.

5. **SoundPad Manager (core/soundpad_manager.py)** - Управление подключением и воспроизведением через SoundPad с использованием библиотеки soundpad_control. Поддерживает автозапуск SoundPad, обнаружение запущенного процесса, воспроизведение в динамики и микрофон одновременно, очистку добавленных звуков после воспроизведения, повторные попытки при ошибках.

6. **Голосовой переводчик (core/voice_translator.py)** - Основной модуль обработки. Содержит:
   - AudioCapture: асинхронный захват аудио с микрофона через sounddevice
   - SpeechRecognition: преобразование аудио в текст через Whisper (офлайн)
   - TextTranslation: офлайн-перевод через Argos Translate с автоматической установкой моделей
   - SpeechSynthesis: синтез речи через Edge TTS (онлайн)
   - HotkeyManager: управление горячей клавишей с обработкой нажатий и отпусканий
   - StateManager: управление состояниями приложения (IDLE, RECORDING, PROCESSING, PLAYING)

#### Поток данных

1. Пользователь нажимает и удерживает горячую клавишу (по умолчанию Page Up)
2. Система переходит в состояние RECORDING и начинает запись аудио с микрофона в буфер
3. При отпускании клавиши (если удержано >0.1с) запись останавливается
4. Аудио передается в Whisper для распознавания речи на исходном языке
5. Распознанный текст переводится на целевой язык через Argos Translate
6. Переведенный текст синтезируется в речь с помощью Edge TTS с заданными параметрами голоса, темпа и громкости
7. Полученный аудиофайл передается в SoundPad Manager
8. SoundPad Manager добавляет файл в SoundPad, воспроизводит его в динамики и микрофон, затем очищает запись
9. Система возвращается в состояние IDLE

### Конфигурация

Приложение использует JSON-конфигурацию (`config.json`) с секциями:

- **app**: уровень логирования (log_level) и горячая клавиша (hotkey)
- **translation**: языки перевода (source_lang, target_lang) и модель Whisper
- **tts**: параметры синтеза речи (голос, скорость, громкость)
- **soundpad**: каналы воспроизведения (play_in_speakers, play_in_microphone)

Технические параметры (частота дискретизации, таймауты, пути к файлам) вынесены в файл `constants.py` и не требуют изменения пользователем.

### Требования

- Python 3.8+
- Установленный SoundPad с поддержкой удаленного управления
- Доступ к микрофону
- Интернет-соединение для первоначальной загрузки моделей Whisper и Argos Translate, а также для работы Edge TTS